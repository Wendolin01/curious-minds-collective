{{ $bootstrapJavascript := site.Params.doks.bootstrapJavascript -}}
{{ if $bootstrapJavascript -}}
  {{ partial "footer/esbuild" (dict "src" "js/bootstrap.js" "load" "async" "transpile" false) -}}
{{- end }}

{{ partial "footer/esbuild" (dict "src" "js/app.js" "targetPath" "main.js" "load" "async" "transpile" false) -}}

{{ partial "footer/script-footer-custom.html" . -}}

{{ partial "main/showFlexSearch" . -}}
{{ $showFlexSearch := .Scratch.Get "showFlexSearch" -}}
{{ $searchLimit := site.Params.doks.searchLimit -}}
{{ if $showFlexSearch -}}
  {- /* Initialize variables */ -}}
  {{- $flexsearchDefaultPath := "js/flexsearch.js" -}}
  {{- $flexsearchLangConfigPath := $flexsearchDefaultPath -}}

  {{- /* Set the path for language-specific JS file if the site is multilingual */ -}}
  {{- if site.LanguagePrefix -}}
    {{- $flexsearchLangConfigPath = printf "js/flexsearch.%s.js" site.Language.Lang -}}
  {{- end -}}

  {{- /* Find the original JS file and attempt to copy it if necessary */ -}}
  {{- $flexSearchResource := resources.Get $flexsearchDefaultPath -}}
  {{- if $flexSearchResource -}}
    {{- if ne $flexsearchLangConfigPath $flexsearchDefaultPath -}}
      {{- /* Only copy if the language path is different from the default */ -}}
      {{- $unusedVar := $flexSearchResource | resources.Copy $flexsearchLangConfigPath -}}
      {{- $flexsearchLangConfigPath := $unusedVar.Permalink -}}
      {{- if not $unusedVar -}}
        {{- warnf "Failed to copy resource from %s to %s" $flexsearchDefaultPath $flexsearchLangConfigPath -}}
      {{- end -}}
    {{- end -}}
  {{- else -}}
    {{- warnf "Original JS file not found at %s" $flexsearchDefaultPath -}}
  {{- end -}}
  {{- warnf "Flex JS file at %s" $flexsearchLangConfigPath -}}
  {{- /* Call partials to load the JS files */ -}}
  {{ partial "footer/esbuild-template" (dict "src" $flexsearchLangConfigPath "load" "async" "transpile" false "isMultilingual" site.IsMultiLingual "searchLimit" $searchLimit) -}}
  {{ partial "footer/esbuild" (dict "src" "js/search-modal.js" "load" "async" "transpile" false) -}}
{{ end -}}
